[config]
default_to_workspace = false

[tasks.build]
description = "Build the snake game"
command = "cargo"
args = ["build"]

[tasks.build.env]
LIBRARY_PATH = { value = "/opt/homebrew/lib:${LIBRARY_PATH}", condition = { platforms = ["mac"] } }

[tasks.build-release]
description = "Build the snake game in release mode"
command = "cargo"
args = ["build", "--release"]

[tasks.build-release.env]
LIBRARY_PATH = { value = "/opt/homebrew/lib:${LIBRARY_PATH}", condition = { platforms = ["mac"] } }

[tasks.run]
description = "Run the snake game"
command = "cargo"
args = ["run"]

[tasks.run.env]
LIBRARY_PATH = { value = "/opt/homebrew/lib:${LIBRARY_PATH}", condition = { platforms = ["mac"] } }
PATH = { value = "${CARGO_MAKE_WORKING_DIRECTORY}/third-party/vcpkg/installed/x64-windows/bin;${PATH}", condition = { platforms = ["windows"] } }

[tasks.clean]
description = "Clean build artifacts"
command = "cargo"
args = ["clean"]

[tasks.check]
description = "Check the project for errors"
command = "cargo"
args = ["check"]

[tasks.format]
description = "Format the code"
command = "cargo"
args = ["fmt"]

[tasks.test]
description = "Run tests"
command = "cargo"
args = ["test"]

[tasks.dist]
description = "Build release and create distribution package"
windows_alias = "dist-windows"

[tasks.dist-windows]
description = "Create Windows distribution package with all dependencies"
script = '''
echo "Building release version..."
cargo build --release

echo "Creating distribution directory..."
rm -rf dist
mkdir -p dist

echo "Copying executable..."
cp target/release/snake-game.exe dist/

echo "Copying configuration..."
cp config.toml dist/

echo "Copying assets..."
cp -r assets dist/

echo "Copying SDL2 runtime DLLs..."
cp third-party/vcpkg/installed/x64-windows/bin/SDL2.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/SDL2_ttf.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/SDL2_mixer.dll dist/

echo "Copying SDL2_ttf dependencies..."
cp third-party/vcpkg/installed/x64-windows/bin/freetype.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/libpng16.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/zlib1.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/brotlicommon.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/brotlidec.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/bz2.dll dist/

echo "Copying SDL2_mixer dependencies..."
cp third-party/vcpkg/installed/x64-windows/bin/ogg.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/vorbis.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/vorbisenc.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/vorbisfile.dll dist/
cp third-party/vcpkg/installed/x64-windows/bin/wavpackdll.dll dist/

echo ""
echo "âœ… Distribution package created in dist/"
echo "ðŸ“¦ Contents:"
ls -lh dist/
echo ""
echo "Total size:"
du -sh dist/
'''

[tasks.run-dist]
description = "Run the distribution build"
condition = { platforms = ["windows"], files_exist = ["${CARGO_MAKE_WORKING_DIRECTORY}/dist/snake-game.exe"] }
script = '''
cd dist && ./snake-game.exe
'''
